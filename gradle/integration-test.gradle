sourceSets {
  integrationTest {
    groovy {
      srcDir file('src/integrationTest/groovy')
      compileClasspath += main.output + test.output
      runtimeClasspath += main.output + test.output
    }
  }
}

configurations {
  integrationTestCompile.extendsFrom implementation
  integrationTestCompile.extendsFrom runtimeOnly
  integrationTestCompile.extendsFrom testImplementation
  integrationTestRuntime.extendsFrom testRuntime
}

task integrationTest(type: Test) {
  testClassesDirs = sourceSets.integrationTest.output.classesDirs
  classpath = sourceSets.integrationTest.runtimeClasspath
}

check.dependsOn integrationTest
